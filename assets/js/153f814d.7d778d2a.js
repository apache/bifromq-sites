"use strict";(globalThis.webpackChunkbifromq=globalThis.webpackChunkbifromq||[]).push([[31],{31155(e,n,t){t.r(n),t.d(n,{assets:()=>d,contentTitle:()=>l,default:()=>u,frontMatter:()=>r,metadata:()=>i,toc:()=>a});const i=JSON.parse('{"id":"deploy/cluster","title":"Deploy BifroMQ Cluster","description":"Prerequisites","source":"@site/versioned_docs/version-2.1.x/03_deploy/21_cluster.md","sourceDirName":"03_deploy","slug":"/deploy/cluster","permalink":"/docs/2.1.x/deploy/cluster","draft":false,"unlisted":false,"editUrl":"https://github.com/apache/bifromq-sites/tree/master/versioned_docs/version-2.1.x/03_deploy/21_cluster.md","tags":[],"version":"2.1.x","sidebarPosition":21,"frontMatter":{"sidebar_position":21},"sidebar":"tutorialSidebar","previous":{"title":"Deploy from source","permalink":"/docs/2.1.x/deploy/build_from_source"},"next":{"title":"Configuration","permalink":"/docs/2.1.x/category/configuration"}}');var o=t(62615),s=t(35756);const r={sidebar_position:21},l="Deploy BifroMQ Cluster",d={},a=[{value:"Prerequisites",id:"prerequisites",level:2},{value:"Installation Steps",id:"installation-steps",level:2},{value:"Configurations",id:"configurations",level:3},{value:"Setup Leader Node",id:"setup-leader-node",level:3},{value:"Setup follower Nodes",id:"setup-follower-nodes",level:3},{value:"Cluster Deploying Check",id:"cluster-deploying-check",level:3},{value:"Deploy Convention",id:"deploy-convention",level:3}];function c(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,s.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.header,{children:(0,o.jsx)(n.h1,{id:"deploy-bifromq-cluster",children:"Deploy BifroMQ Cluster"})}),"\n",(0,o.jsx)(n.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Ensure you have a JDK 17+ environment installed."}),"\n",(0,o.jsxs)(n.li,{children:["Obtain the latest version of BifroMQ from ",(0,o.jsx)(n.a,{href:"https://github.com/bifromqio/bifromq",children:"GitHub"}),"."]}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"installation-steps",children:"Installation Steps"}),"\n",(0,o.jsxs)(n.p,{children:["In this section, we'll illustrate the deployment of a 3-node cluster. Being Similar with ",(0,o.jsx)(n.a,{href:"/docs/2.1.x/deploy/deploy_on_linux_mac",children:"deploying in Linux"}),",\nyou can extract the downloaded tar file first."]}),"\n",(0,o.jsx)(n.h3,{id:"configurations",children:"Configurations"}),"\n",(0,o.jsx)(n.p,{children:"By default, a configuration file is provided with the following settings:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",children:'bootstrap: true\n\nmqttServerConfig:\n  tcpListener:\n    port: 1883\n\n# config for building BifroMQ cluster\nclusterConfig:\n  # The environment of the cluster, cluster member under same env can communicate with each other\n  env: "Test"\n  # The host address to bind for inter-member communication. If left blank, a site-local address will be used if available\n  host:\n  # This is the port for listening to cluster membership-related messages. If left blank, the operating system will help \n  # find an available one automatically.\n  # For seed nodes, it is recommended to specify an explicit port number to simplify the cluster building process.\n  port:\n  # Optionally using DNS to achieve cluster member address discovery, it can be used in K8S env deployment\n  clusterDomainName:\n  # comma separated list of <ADDRESS>:<PORT> for joining the cluster\n  seedEndpoints:\n'})}),"\n",(0,o.jsxs)(n.p,{children:["Before setting up the cluster, you need specify ",(0,o.jsx)(n.code,{children:"seedPoints"})," in format of comma separated list of ",(0,o.jsx)(n.code,{children:"<ADDRESS>:<PORT>"}),",\ne.g. ",(0,o.jsx)(n.code,{children:"clusterConfig.port: ${PORT} clusterConfig.seedEndpoints: N1:${PORT},N2:${PORT},N3:${PORT}"}),".\nFor detailed configuration information, please check ",(0,o.jsx)(n.a,{href:"/docs/2.1.x/configuration/file_configs_manual",children:"here"}),"."]}),"\n",(0,o.jsx)(n.h3,{id:"setup-leader-node",children:"Setup Leader Node"}),"\n",(0,o.jsxs)(n.p,{children:["Run the script ",(0,o.jsx)(n.code,{children:"./bin/standalone.sh start"})," to start the leader node."]}),"\n",(0,o.jsx)(n.h3,{id:"setup-follower-nodes",children:"Setup follower Nodes"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["For followers, set ",(0,o.jsx)(n.code,{children:"bootstrap"})," configuration to ",(0,o.jsx)(n.code,{children:"false"}),"."]}),"\n",(0,o.jsxs)(n.li,{children:["Run the script ",(0,o.jsx)(n.code,{children:"./bin/standalone.sh start"})," to start the followers."]}),"\n"]}),"\n",(0,o.jsx)(n.h3,{id:"cluster-deploying-check",children:"Cluster Deploying Check"}),"\n",(0,o.jsxs)(n.p,{children:["After running the script, the nodes will form a cluster and generate the ",(0,o.jsx)(n.code,{children:"AgentHost joined  seedEndpoint: ${seedEndpoints}"})," logs on their respective machines."]}),"\n",(0,o.jsx)(n.h3,{id:"deploy-convention",children:"Deploy Convention"}),"\n",(0,o.jsx)(n.p,{children:"Configurations may vary between different versions. While deploying BifroMQ, you can use previous configurations to set\nit up, and it won't interrupt the running of BifroMQ. However, please note that these configurations may not take an effect."}),"\n",(0,o.jsx)(n.p,{children:"Additionally, at the start of the info log, the complete configurations will be printed."})]})}function u(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(c,{...e})}):c(e)}},35756(e,n,t){t.d(n,{R:()=>r,x:()=>l});var i=t(59471);const o={},s=i.createContext(o);function r(e){const n=i.useContext(s);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:r(e.components),i.createElement(s.Provider,{value:n},e.children)}}}]);