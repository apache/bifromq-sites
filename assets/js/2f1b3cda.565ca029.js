"use strict";(globalThis.webpackChunkbifromq=globalThis.webpackChunkbifromq||[]).push([[5153],{9583(e,n,o){o.r(n),o.d(n,{assets:()=>d,contentTitle:()=>c,default:()=>p,frontMatter:()=>l,metadata:()=>i,toc:()=>m});const i=JSON.parse('{"id":"installation/docker","title":"Docker","description":"Prerequisites","source":"@site/docs/installation/docker.mdx","sourceDirName":"installation","slug":"/installation/docker","permalink":"/docs/installation/docker","draft":false,"unlisted":false,"editUrl":"https://github.com/apache/bifromq-sites/tree/master/docs/installation/docker.mdx","tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"sidebar_position":1,"title":"Docker"},"sidebar":"tutorialSidebar","previous":{"title":"Installation Overview","permalink":"/docs/installation/intro"},"next":{"title":"Linux","permalink":"/docs/installation/linux"}}');var r=o(62615),t=o(35756),s=(o(59471),o(43088)),a=o(58992);const l={sidebar_position:1,title:"Docker"},c=void 0,d={},m=[{value:"Prerequisites",id:"prerequisites",level:2},{value:"Docker Command",id:"docker-command",level:2},{value:"Memory Constraints",id:"memory-constraints",level:2}];function h(e){const n={a:"a",code:"code",em:"em",h2:"h2",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"https://www.docker.com/",children:"Docker"})," is installed."]}),"\n",(0,r.jsx)(n.li,{children:"You have permission to use port 1883, and the port is available. If you do not have permission, please change to the corresponding port."}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"docker-command",children:"Docker Command"}),"\n",(0,r.jsxs)(n.p,{children:["Run the following command, which will run Apache BifroMQ within a container as the Linux user ",(0,r.jsx)(n.code,{children:"bifromq"}),"."]}),"\n",(0,r.jsx)(s.A,{language:"bash",children:`docker run -d --name bifromq -p 1883:1883 apache/bifromq:${(0,a.r)().label}`}),"\n",(0,r.jsx)(n.h2,{id:"memory-constraints",children:"Memory Constraints"}),"\n",(0,r.jsx)(n.p,{children:"By default, upon Apache BifroMQ process initiation, it dynamically computes the relevant JVM parameters based on the physical memory of the hosting server. However, when launched within a containerized environment, it introspects the host\nmachine's physical memory, potentially causing conflicts with Docker or container-imposed memory constraints, consequently leading to the premature termination of the container."}),"\n",(0,r.jsxs)(n.p,{children:["To circumvent such challenges, it is advisable to proactively delimit the container's memory consumption and convey these limitations to the container runtime via environmental variables. During the startup of BifroMQ, priority is given to\nthe calculation of JVM parameters based on the ",(0,r.jsx)(n.code,{children:"MEM_LIMIT"})," environmental variable. A specific illustration is provided below:"]}),"\n",(0,r.jsx)(s.A,{language:"bash",children:`docker run -d -m 10G -e MEM_LIMIT='10737418240'--name bifromq -p 1883:1883 apache/bifromq:${(0,a.r)().label}`}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.em,{children:(0,r.jsx)(n.strong,{children:"Note: The unit of MEM_LIMIT is in bytes."})})}),"\n",(0,r.jsx)(n.p,{children:"Going a step further, it is possible to proactively configure the JVM heap memory and directly transmit it to the container runtime for utilization by BifroMQ. A specific illustration is provided below:"}),"\n",(0,r.jsx)(s.A,{language:"bash",children:`docker run -d -m 10G -e JVM_HEAP_OPTS='-Xms2G -Xmx4G -XX:MetaspaceSize=128m -XX:MaxMetaspaceSize=500m -XX:MaxDirectMemorySize=1G' --name bifromq -p 1883:1883 apache/bifromq:${(0,a.r)().label}`}),"\n",(0,r.jsx)(n.p,{children:"You can build an Apache BifroMQ cluster using Docker Compose on a single host for development and testing. Suppose you want to create a cluster with three nodes: node1,\nnode2, and node3. The directory structure should be as follows:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"|- docker-compose.yml\n|- node1\n|- node2\n|- node3\n"})}),"\n",(0,r.jsx)(n.p,{children:"Each node should have a configuration file, it is defined as follows:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yml",children:'clusterConfig:\n  env: "Test"\n  host: bifromq-node1 # Change this to bifromq-node2 for node2 and bifromq-node3 for node3\n  port: 8899\n  seedEndpoints: "bifromq-node1:8899,bifromq-node2:8899,bifromq-node3:8899"\n'})}),"\n",(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.code,{children:"docker-compose.yml"})," file defines the services for the three nodes:"]}),"\n",(0,r.jsx)(s.A,{language:"yaml",children:`services:\nbifromq-node1:\n  image: apache/bifromq:${(0,a.r)().label}\n  container_name: bifromq-node1\n  volumes:\n    - ./node1/standalone.yml:/home/bifromq/conf/standalone.yml\n  ports:\n    - "1883:1883"\n  environment:\n    - MEM_LIMIT=10737418240 # Adjust the value according to the actual host configuration.\n  networks:\n    - bifromq-net\n\nbifromq-node2:\n  image: apache/bifromq:${(0,a.r)().label}\n  container_name: bifromq-node2\n  volumes:\n    - ./node2/standalone.yml:/home/bifromq/conf/standalone.yml\n  ports:\n    - "1884:1883"\n  environment:\n    - MEM_LIMIT=2147483648\n  networks:\n    - bifromq-net\n\nbifromq-node3:\n  image: apache/bifromq:${(0,a.r)().label}\n  container_name: bifromq-node3\n  volumes:\n    - ./node3/standalone.yml:/home/bifromq/conf/standalone.yml\n  ports:\n    - "1885:1883"\n  environment:\n    - MEM_LIMIT=2147483648\n  networks:\n    - bifromq-net\n\nnetworks:\nbifromq-net:\n  driver: bridge`}),"\n",(0,r.jsx)(n.p,{children:"To launch the cluster, run the following command:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"docker compose up -d\n"})})]})}function p(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(h,{...e})}):h(e)}}}]);