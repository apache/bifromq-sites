"use strict";(self.webpackChunkbifromq=self.webpackChunkbifromq||[]).push([[23541],{28010:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>c,contentTitle:()=>h,default:()=>p,frontMatter:()=>l,metadata:()=>t,toc:()=>u});var t=i(96505),r=i(65813),s=i(53546),a=i(8069),o=i.n(a);const l={slug:"AnyAuth and Integration with BifroMQ",title:"AnyAuth and Integration with BifroMQ",authors:"Jiawei",tags:["Auth","Plugin"]},h=void 0,c={authorsImageUrls:[void 0]},u=[{value:"BifroMQ in Smart Home",id:"bifromq-in-smart-home",level:2},{value:"Background",id:"background",level:3},{value:"Key Participants",id:"key-participants",level:3},{value:"End Users",id:"end-users",level:3},{value:"AnyAuth in BifroMQ",id:"anyauth-in-bifromq",level:3},{value:"Setup Steps",id:"setup-steps",level:2},{value:"Prerequisites",id:"prerequisites",level:3},{value:"Configure AnyAuth Plugin",id:"configure-anyauth-plugin",level:3},{value:"Setup BifroMQ with Plugin",id:"setup-bifromq-with-plugin",level:3},{value:"Setup AnyAuth Service",id:"setup-anyauth-service",level:3},{value:"End-to-End Demo",id:"end-to-end-demo",level:2}];function d(e){const n={a:"a",code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.strong,{children:"AnyAuth"})," plugin is a powerful extension built upon the BifroMQ ",(0,r.jsx)(n.code,{children:"IAuthProvider"})," interface using PF4J. It is\ndesigned to provide seamless authentication and authorization capabilities for BifroMQ, enabling users to secure access\nto messages and resources across a wide range of clients."]}),"\n",(0,r.jsx)(n.h2,{id:"bifromq-in-smart-home",children:"BifroMQ in Smart Home"}),"\n",(0,r.jsx)(n.h3,{id:"background",children:"Background"}),"\n",(0,r.jsx)(n.p,{children:"Company A is a firm specializing in the smart home industry. They aim to enhance their product's value and user\nexperience by incorporating IoT (Internet of Things) technology, allowing remote control of their products. They have\nchosen BifroMQ as their MQTT message middleware, integrated into their IoT platform to connect their smart home devices\nto the internet."}),"\n",(0,r.jsx)(n.h3,{id:"key-participants",children:"Key Participants"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Company A: Smart home devices manufacturer looking to enhance product value and user experience through IoT technology."}),"\n",(0,r.jsx)(n.li,{children:"Company B: Software development company responsible for developing the IoT platform and WeChat Mini Program for\ncompany A."}),"\n",(0,r.jsx)(n.li,{children:"BifroMQ: MQTT message middleware providing reliable message transmission services, integrated into the IoT platform\nby company B."}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"end-users",children:"End Users"}),"\n",(0,r.jsx)(n.p,{children:"As users of the smart home devices, we anticipate the ability to remotely control the devices, e.g. air conditioner,\nadjust the temperature, check the current indoor temperature, and monitor the air conditioner's operational status\nthrough the WeChat Mini Program."}),"\n",(0,r.jsx)(n.h3,{id:"anyauth-in-bifromq",children:"AnyAuth in BifroMQ"}),"\n",(0,r.jsxs)(n.p,{children:["The versatility of the ",(0,r.jsx)(n.strong,{children:"AnyAuth"})," plugin lies in its support for various authentication mechanisms, including\ntraditional username/password that is for devices, auth0, and even WeChat integration. This means that users can be\nauthenticated by using their preferred social accounts, simplifying access to BifroMQ."]}),"\n",(0,r.jsxs)(n.p,{children:["Furthermore, ",(0,r.jsx)(n.strong,{children:"AnyAuth"})," seamlessly integrates with BifroMQ, offering Role-Based Access Control (RBAC) through\nAccess Control Lists (ACL). This feature empowers administrators to define distinct roles and permissions, which can\nthen ensure fine-grained access control."]}),"\n",(0,r.jsxs)(n.p,{children:["For more information and technical design, check the ",(0,r.jsx)(n.a,{href:"https://github.com/Gujiawei-Edinburgh/bifromq-plugin-anyAuth#readme",children:"article"}),"."]}),"\n",(0,r.jsx)(n.h2,{id:"setup-steps",children:"Setup Steps"}),"\n",(0,r.jsxs)(n.p,{children:["Integrating ",(0,r.jsx)(n.strong,{children:"AnyAuth"})," with BifroMQ has proven to be remarkably straightforward. Here's a concise rundown to get\nstarted:"]}),"\n",(0,r.jsx)(n.h3,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,r.jsx)(n.p,{children:"Before we dive in, it's essential to understand that AnyAuth's primary focus lies in querying users' credentials and\ncorresponding ACL rules. Handling administrative tasks, such as user registration and ACL specification, falls under\nthe purview of other services. To ensure a smooth data retrieval process, users must complete device registration and\nspecify ACL requirements in advance."}),"\n",(0,r.jsx)(n.h3,{id:"configure-anyauth-plugin",children:"Configure AnyAuth Plugin"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"AnyAuth"}),"'s flexibility hinges on the correct configuration of authentication parameters. These parameters can vary\ndepending on your chosen authentication method (e.g., username/password, auth0 and WeChat). The configuration file can\nbe found in the ",(0,r.jsx)(n.code,{children:"bifromq-plugin-anyAuth/auth-plugin/src/main/resources"})," directory and will be packaged into the JAR file\nafter compilation. Therefore, it's crucial to configure it first."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"tenantId: ${TENANTID}\ndevice:\n  authUrl: ${AUTH_SERVICE_AUTH_URL}\n  checkUrl: ${AUTH_SERVICE_CHECK_URL}\nauth0:\n  domain: ${AUTH0_DOMAIN}\nwechat:\n  appId: ${APP_ID}\n  appSecret: ${APP_SECRET}\n  requestUrl: https://api.weixin.qq.com/sns/jscode2session?appid=\n"})}),"\n",(0,r.jsx)(n.h3,{id:"setup-bifromq-with-plugin",children:"Setup BifroMQ with Plugin"}),"\n",(0,r.jsxs)(n.p,{children:["Now, let's move to the practical implementation. In your ",(0,r.jsx)(n.strong,{children:"AnyAuth"})," project directory, run the following command to\ngenerate the necessary output:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-mvn",children:"cd bifromq-plugin-anyAuth && mvn clean package\n"})}),"\n",(0,r.jsxs)(n.p,{children:["This command will generate an ",(0,r.jsx)(n.code,{children:"auth-plugin-${VERSION}.jar"})," and ",(0,r.jsx)(n.code,{children:"auth-service-${VERSION}.tar.gz"})," file in their respective\ntarget directories."]}),"\n",(0,r.jsxs)(n.p,{children:["To ensure BifroMQ correctly loads the ",(0,r.jsx)(n.strong,{children:"AnyAuth"})," plugin, place the corresponding JAR file in the plugins directory\nwithin BifroMQ's target directory, i.e. ",(0,r.jsx)(n.code,{children:"bifromq-${VERSION}/plugins"}),". Additionally, specify the Fully Qualified Name (FQN),\ne.g. ",(0,r.jsx)(n.code,{children:"authProviderFQN: bifromq.plugin.auth.AuthProvider"}),", in BifroMQ's configuration file (",(0,r.jsx)(n.code,{children:"conf/standalone.yml"}),")."]}),"\n",(0,r.jsx)(n.h3,{id:"setup-anyauth-service",children:"Setup AnyAuth Service"}),"\n",(0,r.jsxs)(n.p,{children:["The plugin JAR file acts as a client for authentication and authorization, while the ",(0,r.jsx)(n.strong,{children:"AnyAuth"})," service handles database\nquery operations. Deploy the ",(0,r.jsx)(n.strong,{children:"AnyAuth"})," service, specifying MySQL connection parameters for credentials and permission\nrules queries."]}),"\n",(0,r.jsxs)(n.p,{children:["For development or testing purposes, ",(0,r.jsx)(n.strong,{children:"AnyAuth"})," also supports dummy storage, i.e. set ",(0,r.jsx)(n.code,{children:"type: Dummy"})," in ",(0,r.jsx)(n.strong,{children:"AnyAuth"}),"\nservice configuration file."]}),"\n",(0,r.jsx)(n.h2,{id:"end-to-end-demo",children:"End-to-End Demo"}),"\n",(0,r.jsx)(n.p,{children:"With all the setup steps completed, we can now embark on an exciting journey. Utilize a WeChat MiniProgram to log in to\nBifroMQ, and a user-friendly GUI application to simulate devices. The video below showcases a typical scenario: a device\nreporting the current temperature via BifroMQ, and a WeChat MiniProgram receiving the message, subsequently issuing\ncommands based on the data."}),"\n",(0,r.jsx)("div",{className:"video__wrapper",children:(0,r.jsx)(o(),{className:"video__player",controls:!0,height:"100%",url:"https://github.com/Gujiawei-Edinburgh/bifromq-plugin-anyAuth/assets/55412783/df9f9009-e96f-4c97-b25a-aa399196fbd9",width:"100%"})})]})}function p(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},96505:e=>{e.exports=JSON.parse('{"permalink":"/blog/AnyAuth and Integration with BifroMQ","editUrl":"https://github.com/apache/bifromq-sites/tree/master/blog","source":"@site/blog/2023-09-04-bifromq-auth-plugin.mdx","title":"AnyAuth and Integration with BifroMQ","description":"The AnyAuth plugin is a powerful extension built upon the BifroMQ IAuthProvider interface using PF4J. It is","date":"2023-09-04T00:00:00.000Z","tags":[{"inline":true,"label":"Auth","permalink":"/blog/tags/auth"},{"inline":true,"label":"Plugin","permalink":"/blog/tags/plugin"}],"readingTime":3.54,"hasTruncateMarker":true,"authors":[{"name":"Gu Jiawei","url":"https://github.com/Gujiawei-Edinburgh","imageURL":"https://github.com/Gujiawei-Edinburgh.png","key":"Jiawei","page":null}],"frontMatter":{"slug":"AnyAuth and Integration with BifroMQ","title":"AnyAuth and Integration with BifroMQ","authors":"Jiawei","tags":["Auth","Plugin"]},"unlisted":false,"prevItem":{"title":"BifroMQ Technical Architecture Overview","permalink":"/blog/bifromq-tech-architecture"},"nextItem":{"title":"BifroMQ officially open source : high-performance multi-tenant MQTT Broker","permalink":"/blog/news-bifromq-opensource"}}')}}]);