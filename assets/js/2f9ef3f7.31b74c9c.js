"use strict";(self.webpackChunkbifromq=self.webpackChunkbifromq||[]).push([[1621],{25948:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>a,default:()=>h,frontMatter:()=>s,metadata:()=>i,toc:()=>l});const i=JSON.parse('{"id":"plugin/auth_provider","title":"Auth Provider","description":"The Auth Provider plugin is designed to provide BifroMQ runtime with the capability to authenticate MQTT client connections and authorize Pub/Sub message topics. The interface for the plugin is defined in the following Maven module:","source":"@site/versioned_docs/version-2.1.x/06_plugin/2_auth_provider.md","sourceDirName":"06_plugin","slug":"/plugin/auth_provider","permalink":"/docs/2.1.x/plugin/auth_provider","draft":false,"unlisted":false,"editUrl":"https://github.com/apache/bifromq-sites/tree/master/versioned_docs/version-2.1.x/06_plugin/2_auth_provider.md","tags":[],"version":"2.1.x","sidebarPosition":2,"frontMatter":{"sidebar_position":2,"title":"Auth Provider"},"sidebar":"tutorialSidebar","previous":{"title":"Overview","permalink":"/docs/2.1.x/plugin/plugin"},"next":{"title":"Event Collector","permalink":"/docs/2.1.x/plugin/event_collector"}}');var o=t(65813),r=t(53546);const s={sidebar_position:2,title:"Auth Provider"},a="Auth Provider Plugin",c={},l=[{value:"Authentication",id:"authentication",level:2},{value:"MQTT3AuthData",id:"mqtt3authdata",level:4},{value:"MQTT3AuthResult",id:"mqtt3authresult",level:4},{value:"Authorization",id:"authorization",level:2},{value:"ClientInfo",id:"clientinfo",level:4},{value:"MQTTAction",id:"mqttaction",level:4},{value:"DevOnly Mode",id:"devonly-mode",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h4:"h4",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,r.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.header,{children:(0,o.jsx)(n.h1,{id:"auth-provider-plugin",children:"Auth Provider Plugin"})}),"\n",(0,o.jsx)(n.p,{children:"The Auth Provider plugin is designed to provide BifroMQ runtime with the capability to authenticate MQTT client connections and authorize Pub/Sub message topics. The interface for the plugin is defined in the following Maven module:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"<dependency>\n    <groupId>com.baidu.bifromq</groupId>\n    <artifactId>bifromq-plugin-auth-provider</artifactId>\n    <version>X.Y.Z</version> \x3c!--replace X.Y.Z with the latest version number--\x3e\n</dependency>\n"})}),"\n",(0,o.jsx)(n.h2,{id:"authentication",children:"Authentication"}),"\n",(0,o.jsx)(n.p,{children:"The authentication of MQTT client connections takes place during the Connect phase. BifroMQ currently supports authentication for clients using the MQTT 3.1 and 3.1.1 protocols. The plugin\u2019s callback interface is as follows:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-java",children:"CompletableFuture<MQTT3AuthResult> auth(MQTT3AuthData authData);\n"})}),"\n",(0,o.jsxs)(n.p,{children:["Implementers should ensure that the interface implementation is lightweight and non-blocking to avoid negatively affecting the connection performance of BifroMQ.\n",(0,o.jsx)(n.a,{href:"https://github.com/bifromqio/bifromq/blob/main/bifromq-plugin/bifromq-plugin-auth-provider/src/main/proto/mqtt3_auth_types.proto",children:"MQTT3AuthData"}),"\nand ",(0,o.jsx)(n.a,{href:"https://github.com/bifromqio/bifromq/blob/main/bifromq-plugin/bifromq-plugin-auth-provider/src/main/proto/mqtt3_auth_types.proto",children:"MQTT3AuthResult"})," are Protobuf objects, defined as follows:"]}),"\n",(0,o.jsx)(n.h4,{id:"mqtt3authdata",children:"MQTT3AuthData"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-protobuf",children:"message MQTT3AuthData{\n  bool isMQIsdp = 1; // true indicates the client is using MQTT 3.1\n  optional string username = 2; // username specified by the client in Connect\n  optional bytes password = 3; // password specified by the client in Connect\n  optional bytes cert = 4; // TLS certificate used by the client\n  optional string clientId = 5; // client identifier specified by the client in Connect\n  string remoteAddr = 6; // source address of the client\n  uint32 remotePort = 7; // port of the client\n  string channelId = 8; // globally unique identifier for this connection\n}\n"})}),"\n",(0,o.jsx)(n.h4,{id:"mqtt3authresult",children:"MQTT3AuthResult"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-protobuf",children:"message Ok{\n  string tenantId = 1;\n  string userId = 2;\n}\n\nmessage Reject{\n  enum Code {\n    BadPass = 0;\n    NotAuthorized = 1;\n    Error = 2;\n  }\n  Code code = 1;\n  optional string reason = 2; // optional description\n}\n\nmessage MQTT3AuthResult {\n  oneof Type{\n    Ok ok = 1;\n    Reject reject = 2;\n  }\n}\n"})}),"\n",(0,o.jsx)(n.p,{children:"When the client is authenticated successfully, BifroMQ expects the interface to return an Ok structure, with the following fields:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"tenantId: Tenant identifier to which the client's identity belongs"}),"\n",(0,o.jsx)(n.li,{children:"userId: Identifier representing the client"}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:"A Reject return value indicates that the authentication failed. There are currently three supported reasons:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["BadPass: Indicates that authentication information is incorrect. The associated behavior includes:","\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["The MQTT client will receive ",(0,o.jsx)(n.code,{children:"0x04 Connection Refused, bad user name or password"})]}),"\n",(0,o.jsxs)(n.li,{children:["A ",(0,o.jsx)(n.code,{children:"NOT_AUTHORIZED_CLIENT"})," event is generated"]}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["NotAuthorized: Indicates that the client is identified, but not authorized to connect. The associated behavior includes:","\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["The MQTT client will receive ",(0,o.jsx)(n.code,{children:"0x05 Connection Refused, not authorized"})]}),"\n",(0,o.jsxs)(n.li,{children:["A ",(0,o.jsx)(n.code,{children:"UNAUTHENTICATED_CLIENT"})," event is generated"]}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["Error: Other internal errors occurring during the authentication process. Additional error information can be provided through the optional reason field. The associated behavior includes:","\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["The MQTT client will receive ",(0,o.jsx)(n.code,{children:"0x03 Connection Refused, Server unavailable"})]}),"\n",(0,o.jsxs)(n.li,{children:["An ",(0,o.jsx)(n.code,{children:"AUTH_ERROR"})," event is generated, containing the content within the reason field"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"authorization",children:"Authorization"}),"\n",(0,o.jsx)(n.p,{children:"BifroMQ currently supports permission checks for client actions such as Publish, Subscribe, and Unsubscribe. The plugin\u2019s callback interface is as follows:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-java",children:"CompletableFuture<Boolean> check(ClientInfo client,MQTTAction action);\n"})}),"\n",(0,o.jsxs)(n.p,{children:["Implementers should ensure that the interface implementation is lightweight and non-blocking to avoid negatively affecting BifroMQ\u2019s messaging performance.\n",(0,o.jsx)(n.a,{href:"https://github.com/bifromqio/bifromq/blob/main/bifromq-common-type/src/main/proto/commontype/ClientInfo.proto",children:"ClientInfo"}),"\nand ",(0,o.jsx)(n.a,{href:"https://github.com/bifromqio/bifromq/blob/main/bifromq-plugin/bifromq-plugin-auth-provider/src/main/proto/mqtt_actions.proto",children:"MQTTAction"})," are Protobuf objects, defined as follows:"]}),"\n",(0,o.jsx)(n.h4,{id:"clientinfo",children:"ClientInfo"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-protobuf",children:"message MQTT3ClientInfo{\n  bool isMQIsdp = 1; // true indicates the client is using MQTT 3.1\n  string clientId = 2; // clientId specified by the client\n  string ip = 3; // source IP address of the client\n  uint32 port = 4; // port of the client\n  string channelId = 5; // globally unique identifier for the client connection\n}\n\nmessage SysClientInfo{\n  string type = 1;\n}\n\nmessage ClientInfo{\n  string tenantId = 1; // consistent with the tenantId in the Ok structure returned by the auth method\n  string userId = 2; // consistent with the userId in the Ok structure returned by the auth method\n  oneof client_type{\n    SysClientInfo sysClientInfo = 3;\n    MQTT3ClientInfo mqtt3ClientInfo = 4;\n  }\n}\n"})}),"\n",(0,o.jsx)(n.h4,{id:"mqttaction",children:"MQTTAction"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-protobuf",children:"message PubAction {\n  string topic = 1;\n  commontype.QoS qos = 2;\n  bool isRetained = 3;\n}\n\nmessage SubAction {\n  string topicFilter = 1;\n  commontype.QoS qos = 2;\n}\n\nmessage UnsubAction {\n  string topicFilter = 1;\n}\n\nmessage MQTTAction {\n  oneof Type{\n    PubAction pub = 1;\n    SubAction sub = 2;\n    UnsubAction unsub = 3;\n  }\n}\n"})}),"\n",(0,o.jsxs)(n.p,{children:["The check method returns a boolean value asynchronously; true indicates permission granted, while false indicates denied. If the check method terminates with an exception, the final behavior is controlled by the runtime\nsetting ",(0,o.jsx)(n.code,{children:"ByPassPermissionCheck"}),". By default, this setting is true, which means that if check returns an exception, BifroMQ considers the permission check to be passed. However, BifroMQ will always generate an ",(0,o.jsx)(n.code,{children:"ACCESS_CONTROL_ERROR"})," event."]}),"\n",(0,o.jsx)(n.h2,{id:"devonly-mode",children:"DevOnly Mode"}),"\n",(0,o.jsxs)(n.p,{children:["For ease of development and testing, when an AuthPlugin implementation type is not specified, BifroMQ uses the\ndefault ",(0,o.jsx)(n.a,{href:"https://github.com/bifromqio/bifromq/blob/main/bifromq-server/src/main/java/com/baidu/bifromq/server/service/authprovider/DevOnlyAuthProvider.java",children:"DevOnlyAuthProvider"}),". This default implementation does not authenticate the client or\ncheck permissions."]}),"\n",(0,o.jsx)(n.p,{children:"Note that the DevOnly Mode is only recommended for development and testing environments. It should never be used in a production environment, as it lacks security measures."})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(d,{...e})}):d(e)}},53546:(e,n,t)=>{t.d(n,{R:()=>s,x:()=>a});var i=t(59729);const o={},r=i.createContext(o);function s(e){const n=i.useContext(r);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:s(e.components),i.createElement(r.Provider,{value:n},e.children)}}}]);