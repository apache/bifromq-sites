---
sidebar_position: 1
---

# MQTT参数选取

MQTT是一种轻量级的消息传输协议，它被广泛应用于物联网、传感器网络和移动应用程序等领域。当使用MQTT连接时，合理选择参数可以提高通信效率和可靠性。

## 客户端ID（ClientID）

ClientID 是MQTT连接的唯一标识符。在IoTCore中，不同实例之间是隔离的，故实际上 CoreID + ClientID 唯一标识了一个客户端连接。

如果多个客户端使用相同的 ClientID 连接到MQTT服务器，那么只有最后一个连接会被保留，其他连接会被强制断开。

在使用MQTT连接时，客户端ID应该是唯一的，并且应该易于识别。一个通常的做法是，使用固定前缀加上随机生成的UUID作为ClientID：前缀可以用来标识客户端的身份或分组，UUID保证了唯一性。

## QoS级别

QoS级别是MQTT中用于确保消息可靠传递的参数。MQTT定义了三个QoS级别，分别是0、1和2。

- QoS 0表示最多一次传递（At Most Once），消息推送出去后并不检查是否到达。
- QoS 1表示至少一次传递（At Least Once），消息推送后会检查服务端/设备端返回的Ack，若超时则会重发。能保证对方收到消息，但可能存在消息重复。
- QoS 2表示恰好一次传递（Exactly Once）。
选择较高的QoS级别可以提高消息传递的可靠性，但同时也会增加通信的延迟和带宽消耗，并增大对服务器资源的需求。

对于偶尔丢失少量影响不大的消息，建议使用 QoS 0。否则可以使用 QoS 1，并在部署时考虑到这一点，以满足相应的资源需求。


## 清理会话标志（cleanSession）

cleanSession 标志在MQTT中用于确定客户端与MQTT服务器之间是否要保存连接状态。

cleanSession 设置为 True 时，MQTT服务器会清除客户端之前发布的所有消息，同时清除与该客户端相关的连接状态信息。而设置为 False时，MQTT服务器将保留与该客户端相关的连接状态信息，以便客户端可以接收之前发布的消息。

默认情况下，应该选择 cleanSession 为 True 的连接设置。在这种设置下，消息的推送更加快速，需求的服务器资源也将大大减少。我们强烈建议将高频、数量大的消息的订阅连接设置为 cleanSession True。

如果某些Topic下的消息需要在订阅端断线的情况下也不丢失，可以在订阅时设置 cleanSession 为 False。但请注意，这个设置下的消息推送需求的服务器性能大大高于 cleanSession True 的情况，并且因为中间还存在缓存消息的环节，其消息推送的延迟和消息溢出的风险也明显更高。

> 尽量选择 cleanSession True 的设置，只在最必要的情况下使用 cleanSession False。
> 尽量降低使用 cleanSession False 的消息量，这会带来更好的性能和更低的风险。
