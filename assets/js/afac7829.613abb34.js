"use strict";(self.webpackChunkbifromq=self.webpackChunkbifromq||[]).push([[10020],{13724:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>a,contentTitle:()=>l,default:()=>u,frontMatter:()=>s,metadata:()=>t,toc:()=>c});const t=JSON.parse('{"id":"plugin/intro","title":"Plugin Overview","description":"The plugin mechanism is a primary way for BifroMQ to deeply integrate with business systems. Currently, BifroMQ exposes four types of plugin extension interfaces to cater to different usage scenarios:","source":"@site/versioned_docs/version-3.0.x/06_plugin/intro.md","sourceDirName":"06_plugin","slug":"/plugin/intro","permalink":"/docs/3.0.x/plugin/intro","draft":false,"unlisted":false,"editUrl":"https://github.com/apache/bifromq-sites/tree/master/versioned_docs/version-3.0.x/06_plugin/intro.md","tags":[],"version":"3.0.x","sidebarPosition":0,"frontMatter":{"id":"intro","sidebar_position":0,"title":"Plugin Overview"},"sidebar":"tutorialSidebar","previous":{"title":"API Reference","permalink":"/docs/3.0.x/user_guide/api/api_reference"},"next":{"title":"Auth Provider","permalink":"/docs/3.0.x/plugin/auth_provider"}}');var o=i(65813),r=i(53546);const s={id:"intro",sidebar_position:0,title:"Plugin Overview"},l=void 0,a={},c=[{value:"Plugin Development",id:"plugin-development",level:2},{value:"Plugin Deployment",id:"plugin-deployment",level:2},{value:"Version Compatibility",id:"version-compatibility",level:2},{value:"Performance Considerations",id:"performance-considerations",level:2}];function d(e){const n={a:"a",code:"code",h2:"h2",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.p,{children:"The plugin mechanism is a primary way for BifroMQ to deeply integrate with business systems. Currently, BifroMQ exposes four types of plugin extension interfaces to cater to different usage scenarios:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:(0,o.jsx)(n.a,{href:"/docs/3.0.x/plugin/auth_provider",children:"Auth Provider"})}),": Integrates authentication and topic Pub/Sub authorization logic."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:(0,o.jsx)(n.a,{href:"/docs/3.0.x/plugin/event_collector",children:"Event Collector"})}),": Collects runtime events to implement various event-driven business logic."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:(0,o.jsx)(n.a,{href:"/docs/3.0.x/plugin/resource_throttler",children:"Resource Throttler"})}),": Dynamically controls resource usage at the tenant level."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:(0,o.jsx)(n.a,{href:"/docs/3.0.x/plugin/setting_provider/intro",children:"Setting Provider"})}),": Dynamically adjusts tenant-specific MQTT protocol settings."]}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"plugin-development",children:"Plugin Development"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Project Organization: A pf4j project can contain multiple plugin implementations."}),"\n",(0,o.jsx)(n.li,{children:"Singleton Plugins: Extensions of AuthProvider, Resource Throttler, and Setting Provider types are singletons at runtime. The specific type to be loaded needs to be specified through a configuration file."}),"\n",(0,o.jsx)(n.li,{children:"Multiple Instance Plugins: EventCollector allows for multiple different types of instances to exist, with interface methods of these EventCollector instances being called back simultaneously."}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"plugin-deployment",children:"Plugin Deployment"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Plugin Directory: BifroMQ loads plugin implementations (JAR files or directories) from the plugins subdirectory within its installation directory."}),"\n",(0,o.jsx)(n.li,{children:"Classloader Isolation: Each plugin uses an independent ClassLoader to isolate its code from BifroMQ and other plugins."}),"\n",(0,o.jsxs)(n.li,{children:["BifroMQ provides class loading for the following commonly used packages:","\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.code,{children:"com.baidu.bifromq.*"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.code,{children:"io.micrometer.core.*"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.code,{children:"com.google.protobuf.*"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.code,{children:"org.slf4j.*"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Note"}),": Some dependencies inside a plugin, such as ",(0,o.jsx)(n.code,{children:"KafkaProducer"}),", may use Java Reflection during instantiation. This process might use ",(0,o.jsx)(n.code,{children:"Thread.currentThread().getContextClassLoader()"})," to load target classes, which could lead to\na ",(0,o.jsx)(n.code,{children:"ClassNotFoundException"}),".\nFor such cases, it's necessary to explicitly set the context class loader to the corresponding plugin class loader. For example:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-java",children:"ClassLoader contextLoader = Thread.currentThread().getContextClassLoader();\nThread.currentThread().setContextClassLoader(YOUR_PLUGIN_INSTANCE.getClass().getClassLoader());\ntry{\n        // YOUR CODE TO INITIATE KAFKA PRODUCER;\n}\nfinally{\n        Thread.currentThread().setContextClassLoader(contextLoader);\n}\n"})}),"\n",(0,o.jsx)(n.h2,{id:"version-compatibility",children:"Version Compatibility"}),"\n",(0,o.jsx)(n.p,{children:"To ensure optimal compatibility and avoid potential issues, it is advised to deploy your custom plugin with the main version of the BifroMQ main program aligned."}),"\n",(0,o.jsx)(n.p,{children:"Example:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"If BifroMQ's version is 3.x.y, then the version of the plugin interface definition modules used should also be 3.x.y."}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"performance-considerations",children:"Performance Considerations"}),"\n",(0,o.jsx)(n.p,{children:"BifroMQ calls plugin interface methods on worker threads. Ensure plugin interface implementations are lightweight and non-blocking to avoid negatively impacting performance."})]})}function u(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(d,{...e})}):d(e)}},53546:(e,n,i)=>{i.d(n,{R:()=>s,x:()=>l});var t=i(59729);const o={},r=t.createContext(o);function s(e){const n=t.useContext(r);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:s(e.components),t.createElement(r.Provider,{value:n},e.children)}}}]);