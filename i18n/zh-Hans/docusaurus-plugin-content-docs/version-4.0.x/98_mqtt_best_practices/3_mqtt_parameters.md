---
sidebar_position: 3
title: "MQTT参数选择"
---

MQTT 是一种轻量级消息协议，广泛应用于物联网 (IoT)、传感器网络和移动应用等领域。在使用 MQTT 建立连接时，合理选择参数可以提升通信效率和可靠性。

---

## Client ID

Client ID 是 MQTT 连接的唯一标识符。在 IoT Core 中，不同的实例彼此隔离，因此实际上由 CoreID 和 ClientID 的组合唯一标识一个客户端连接。

如果多个客户端尝试使用相同的 Client ID 连接到同一个 MQTT 服务器，则只有最近的连接会被保留，其余的连接将被强制断开。

在使用 MQTT 连接时，确保 Client ID 的唯一性和易于识别至关重要。一种常见的做法是使用固定前缀结合随机生成的 UUID 作为 Client ID。
前缀可以用来标识客户端的身份或组别，而 UUID 则确保了唯一性。

---

## QoS 等级

MQTT 中的服务质量 (QoS) 等级是确保消息可靠传递的参数。MQTT 定义了三个 QoS 等级：0、1 和 2。

- **QoS 0**：表示“至多一次”传递。消息发送后不需要接收方的确认，因此可能丢失。
- **QoS 1**：表示“至少一次”传递。消息会在接收到确认之前重复发送，确保消息能够到达，但可能会出现重复消息。
- **QoS 2**：表示“仅一次”传递，确保消息严格按照一次交付。

选择更高的 QoS 等级可以提高消息传递的可靠性，但同时也会增加通信延迟、带宽消耗以及服务器资源需求。

对于可以容忍偶尔丢失少量消息的场景，建议使用 QoS 等级 0。否则，可以使用 QoS 等级 1，但需要注意在部署时分配必要的资源。

---

## Clean Session 标志位

MQTT 中的 Clean Session 标志位决定了客户端与 MQTT 服务器之间的连接状态是否需要被保留。

当 Clean Session 设置为 `True` 时，MQTT 服务器会清除客户端之前发布的所有消息以及与该客户端相关的连接状态信息。相反，当 Clean Session 
设置为 `False` 时，MQTT 服务器会保留连接状态信息，以便客户端在离线期间发布的消息能被其重新连接后接收。

默认情况下，建议选择 Clean Session 设置为 `True` 的连接方式。在这种设置下，消息传递速度更快，且服务器资源需求显著降低。
对于高频率且消息数量较多的订阅，强烈建议将 Clean Session 设置为 `True`。

如果某些主题的消息在订阅者离线时不允许丢失，可以将 Clean Session 设置为 `False`。但需要注意，与 Clean Session 设置为 `True` 的情况相比，
这种设置需要显著更高的服务器性能。此外，由于中间消息的缓存，还存在消息传递延迟和消息溢出的风险。

> 一般来说，应优先选择 Clean Session 设置为 `True`，仅在绝对必要时使用 Clean Session 设置为 `False`。
> 在使用 Clean Session 设置为 `False` 时，应尽量减少消息的数量，从而获得更好的性能并降低风险。