"use strict";(self.webpackChunkbifromq=self.webpackChunkbifromq||[]).push([[38380],{2520:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>d,contentTitle:()=>a,default:()=>h,frontMatter:()=>o,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"plugin/auth_provider","title":"Auth Provider","description":"The Auth Provider plugin enhances BifroMQ by integrating authentication and authorization functionalities for MQTT clients and Pub/Sub operations. The plugin\'s interface is detailed in the following Maven module:","source":"@site/versioned_docs/version-3.2.x/06_plugin/1_auth_provider.md","sourceDirName":"06_plugin","slug":"/plugin/auth_provider","permalink":"/docs/3.2.x/plugin/auth_provider","draft":false,"unlisted":false,"editUrl":"https://github.com/apache/bifromq-sites/tree/master/versioned_docs/version-3.2.x/06_plugin/1_auth_provider.md","tags":[],"version":"3.2.x","sidebarPosition":2,"frontMatter":{"sidebar_position":2,"title":"Auth Provider"},"sidebar":"tutorialSidebar","previous":{"title":"Plugin Overview","permalink":"/docs/3.2.x/plugin/intro"},"next":{"title":"Event Collector","permalink":"/docs/3.2.x/plugin/event_collector"}}');var r=t(65813),s=t(53546);const o={sidebar_position:2,title:"Auth Provider"},a=void 0,d={},c=[{value:"Authentication",id:"authentication",level:2},{value:"MQTT3AuthData",id:"mqtt3authdata",level:4},{value:"MQTT3AuthResult",id:"mqtt3authresult",level:4},{value:"MQTT5AuthData and MQTT5ExtendedAuthData",id:"mqtt5authdata-and-mqtt5extendedauthdata",level:4},{value:"MQTT5AuthResult and MQTT5ExtendedAuthResult",id:"mqtt5authresult-and-mqtt5extendedauthresult",level:4},{value:"Authorization",id:"authorization",level:2},{value:"ClientInfo",id:"clientinfo",level:4},{value:"MQTTAction",id:"mqttaction",level:4},{value:"CheckResult",id:"checkresult",level:4},{value:"Metrics",id:"metrics",level:2},{value:"DevOnly Mode",id:"devonly-mode",level:2},{value:"Implementation Example",id:"implementation-example",level:2}];function l(e){const n={a:"a",code:"code",h2:"h2",h4:"h4",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,s.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.p,{children:"The Auth Provider plugin enhances BifroMQ by integrating authentication and authorization functionalities for MQTT clients and Pub/Sub operations. The plugin's interface is detailed in the following Maven module:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-xml",children:"\n<dependency>\n    <groupId>com.baidu.bifromq</groupId>\n    <artifactId>bifromq-plugin-auth-provider</artifactId>\n    <version>X.Y.Z</version> \x3c!--replace X.Y.Z with the latest version number--\x3e\n</dependency>\n"})}),"\n",(0,r.jsxs)(n.p,{children:["BifroMQ operates with only one instance of the Auth Provider at any given time. The specific class to be loaded can be configured in ",(0,r.jsx)(n.a,{href:"/docs/3.2.x/admin_guide/configuration/config_file_manual",children:"configuration file"})," by specifying its Fully\nQualified Name (FQN):"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:'authProviderFQN: "YOUR_AUTH_PROVIDER_CLASS"\n'})}),"\n",(0,r.jsx)(n.h2,{id:"authentication",children:"Authentication"}),"\n",(0,r.jsx)(n.p,{children:"During the connection phase, BifroMQ invokes the Auth Provider Plugin's interface methods to authenticate MQTT client connections across versions 3.1, 3.1.1, and 5.0:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:"// Authenticate MQTT 3.1 and 3.1.1 clients\nCompletableFuture<MQTT3AuthResult> auth(MQTT3AuthData authData);\n\n// Authenticate MQTT 5.0 clients\nCompletableFuture<MQTT5AuthResult> auth(MQTT5AuthData authData);\n\n// Enhanced authentication for MQTT 5.0 clients\nCompletableFuture<MQTT5ExtendedAuthResult> extendedAuth(MQTT5ExtendedAuthData authData); \n"})}),"\n",(0,r.jsx)(n.p,{children:"It's crucial to ensure that the implementations of these interface methods are efficient and non-blocking to avoid negatively impacting connection performance. For MQTT 5.0, BifroMQ supports two methods of authentication: Basic and\nExtended. The Basic authentication provides compatibility with MQTT 3 behavior by default."}),"\n",(0,r.jsx)(n.p,{children:"Protobuf objects are utilized for the parameters and return types of these interface methods."}),"\n",(0,r.jsx)(n.h4,{id:"mqtt3authdata",children:(0,r.jsx)(n.a,{href:"https://github.com/bifromqio/bifromq/blob/main/bifromq-plugin/bifromq-plugin-auth-provider/src/main/proto/mqtt3_auth_types.proto",children:"MQTT3AuthData"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-protobuf",children:"message MQTT3AuthData{\n  bool isMQIsdp = 1; // true indicates the client is using MQTT 3.1\n  optional string username = 2; // username specified by the client in Connect\n  optional bytes password = 3; // password specified by the client in Connect\n  optional bytes cert = 4; // TLS certificate used by the client\n  optional string clientId = 5; // client identifier specified by the client in Connect\n  string remoteAddr = 6; // source address of the client\n  uint32 remotePort = 7; // port of the client\n  string channelId = 8; // globally unique identifier for this connection\n}\n"})}),"\n",(0,r.jsx)(n.h4,{id:"mqtt3authresult",children:(0,r.jsx)(n.a,{href:"https://github.com/bifromqio/bifromq/blob/main/bifromq-plugin/bifromq-plugin-auth-provider/src/main/proto/mqtt3_auth_types.proto",children:"MQTT3AuthResult"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-protobuf",children:"message Ok{\n  string tenantId = 1;\n  string userId = 2;\n  map<string, string> attrs = 3; // additional attributes filled by auth provider plugin which will be copied to ClientInfo\n}\n\nmessage Reject{\n  enum Code {\n    BadPass = 0;\n    NotAuthorized = 1;\n    Error = 2;\n  }\n  Code code = 1;\n  optional string tenantId = 2; // optional if tenant can be determined\n  optional string userId = 3; // optional if user can be determined\n  optional string reason = 4; // optional description}\n\n  message MQTT3AuthResult {\n    oneof Type{\n      Ok ok = 1;\n      Reject reject = 2;\n    }\n  }\n"})}),"\n",(0,r.jsxs)(n.h4,{id:"mqtt5authdata-and-mqtt5extendedauthdata",children:[(0,r.jsx)(n.a,{href:"https://github.com/bifromqio/bifromq/blob/main/bifromq-plugin/bifromq-plugin-auth-provider/src/main/proto/mqtt5_auth_types.proto",children:"MQTT5AuthData"})," and ",(0,r.jsx)(n.a,{href:"https://github.com/bifromqio/bifromq/blob/main/bifromq-plugin/bifromq-plugin-auth-provider/src/main/proto/mqtt5_auth_types.proto",children:"MQTT5ExtendedAuthData"})]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-protobuf",children:"message MQTT5AuthData{\n  optional string username = 1;\n  optional bytes password = 2;\n  optional bytes cert = 3;\n  optional string clientId = 4;\n  string remoteAddr = 5;\n  uint32 remotePort = 6;\n  string channelId = 7;\n  bool responseInfo = 8; // for MQTT5 request/response use case\n  commontype.UserProperties userProps = 9;\n}\n\nmessage MQTT5ExtendedAuthData{\n  message Initial{\n    MQTT5AuthData basic = 1;\n    string authMethod = 2;\n    bytes authData = 3;\n  }\n  message Auth{\n    string authMethod = 1;\n    bytes authData = 2;\n    commontype.UserProperties userProps = 3;\n    bool isReAuth = 4;\n  }\n  oneof Type{\n    Initial initial = 1;\n    Auth auth = 2;\n  }\n}\n"})}),"\n",(0,r.jsxs)(n.h4,{id:"mqtt5authresult-and-mqtt5extendedauthresult",children:[(0,r.jsx)(n.a,{href:"https://github.com/bifromqio/bifromq/blob/main/bifromq-plugin/bifromq-plugin-auth-provider/src/main/proto/mqtt5_auth_types.proto",children:"MQTT5AuthResult"})," and ",(0,r.jsx)(n.a,{href:"https://github.com/bifromqio/bifromq/blob/main/bifromq-plugin/bifromq-plugin-auth-provider/src/main/proto/mqtt5_auth_types.proto",children:"MQTT5ExtendedAuthResult"})]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-protobuf",children:"message Success{\n  string tenantId = 1;\n  string userId = 2;\n  map<string, string> attrs = 3; // additional attributes filled by auth provider plugin which will be copied to ClientInfo\n  optional string ResponseInfo = 4; // for mqtt5 request/response use case\n  commontype.UserProperties userProps = 5; // user properties return back via mqtt5 connack\n}\n\nmessage Failed{\n  enum Code {\n    BadPass = 0;\n    NotAuthorized = 1;\n    Banned = 2;\n    BadAuthMethod = 3;\n    Error = 4;\n  }\n  Code code = 1;\n  optional string tenantId = 2; // optional if tenant can be determined\n  optional string userId = 3; // optional if user can be determined\n  optional string reason = 4; // optional description\n  commontype.UserProperties userProps = 5; // user properties return back via mqtt5 connack\n}\n\nmessage Continue{\n  bytes authData = 1;\n  optional string tenantId = 2; // optional if tenant can be determined\n  optional string userId = 3; // optional if user can be determined\n  optional string reason = 4;\n  commontype.UserProperties userProps = 5;\n}\n\nmessage MQTT5AuthResult {\n  oneof Type{\n    Success success = 1;\n    Failed failed = 2;\n  }\n}\n\nmessage MQTT5ExtendedAuthResult {\n  oneof Type{\n    Success success = 1;\n    Continue continue = 2;\n    Failed failed = 3;\n  }\n}\n"})}),"\n",(0,r.jsx)(n.p,{children:"Successful authentication returns an Ok structure with tenantId, userId, and optionally additional metadata in attrs, which is copied to ClientInfo. A Reject return indicates failure due to incorrect authentication info (BadPass),\nunauthorized access (NotAuthorized), or internal errors (Error), with detailed explanations in optional fields."}),"\n",(0,r.jsx)(n.h2,{id:"authorization",children:"Authorization"}),"\n",(0,r.jsx)(n.p,{children:"BifroMQ checks permissions for Publish, Subscribe, and Unsubscribe actions via:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:"CompletableFuture<CheckResult> checkPermission(ClientInfo client, MQTTAction action);\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Ensuring the ",(0,r.jsx)(n.code,{children:"checkPermission"})," method's implementation is efficient and non-blocking is critical to prevent any negative impact on messaging performance. The method leverages ClientInfo with metadata returned from authentication, enabling\nJWT-like authentication and authorization mechanisms. Additionally, the permission check method is not differentiated by the client's MQTT protocol version. However, for clients using MQTT 5.0, the MQTTAction object will contain\nUserProperties from the Control Packets."]}),"\n",(0,r.jsx)(n.p,{children:"In cases of authorization failure for MQTT 5.0 clients, UserProperties included in the result are relayed back to the client within the corresponding MQTT Control Packets' UserProperties, aiding in problem diagnosis."}),"\n",(0,r.jsx)(n.p,{children:"The checkPermission method's parameters and return type are also defined by Protobuf."}),"\n",(0,r.jsx)(n.h4,{id:"clientinfo",children:(0,r.jsx)(n.a,{href:"https://github.com/bifromqio/bifromq/blob/main/bifromq-common-type/src/main/proto/commontype/ClientInfo.proto",children:"ClientInfo"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-protobuf",children:'message ClientInfo{\n  string tenantId = 1;\n  string type = 2; // the type of the calling client, e.g. "mqtt"  \n  map<string, string> metadata = 3; // the metadata of the client\n}\n'})}),"\n",(0,r.jsxs)(n.p,{children:["BifroMQ will include the following predefined metadata in the ",(0,r.jsx)(n.code,{children:"metadata"})," property of the ",(0,r.jsx)(n.code,{children:"ClientInfo"})," object:"]}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Key"}),(0,r.jsx)(n.th,{children:"Description"}),(0,r.jsx)(n.th,{children:"Possible Values"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"ver"})}),(0,r.jsx)(n.td,{children:"MQTT protocol version"}),(0,r.jsxs)(n.td,{children:[(0,r.jsx)(n.code,{children:'"3"'})," (MQTT 3.1), ",(0,r.jsx)(n.code,{children:'"4"'})," (MQTT 3.1.1), ",(0,r.jsx)(n.code,{children:'"5"'})," (MQTT 5)"]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"userId"})}),(0,r.jsx)(n.td,{children:"User ID"}),(0,r.jsx)(n.td,{children:"User-defined string"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"clientId"})}),(0,r.jsx)(n.td,{children:"Client ID"}),(0,r.jsx)(n.td,{children:"User-defined string"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"channelId"})}),(0,r.jsx)(n.td,{children:"Channel ID"}),(0,r.jsx)(n.td,{children:"System-generated unique identifier"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"address"})}),(0,r.jsx)(n.td,{children:"Client address"}),(0,r.jsx)(n.td,{children:"IP address or hostname of the client"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"broker"})}),(0,r.jsx)(n.td,{children:"Broker the client is connected to"}),(0,r.jsx)(n.td,{children:"Broker identifier"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"sessionType"})}),(0,r.jsx)(n.td,{children:"Type of session"}),(0,r.jsxs)(n.td,{children:[(0,r.jsx)(n.code,{children:'"t"'})," (Transient), ",(0,r.jsx)(n.code,{children:'"p"'})," (Persistent)"]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"respInfo"})}),(0,r.jsx)(n.td,{children:"Response information for MQTT 5.0 request/response"}),(0,r.jsx)(n.td,{children:"User-defined string"})]})]})]}),"\n",(0,r.jsx)(n.p,{children:"These metadata fields will not be overwritten by attributes (attrs) passed in the authentication result."}),"\n",(0,r.jsx)(n.h4,{id:"mqttaction",children:(0,r.jsx)(n.a,{href:"https://github.com/bifromqio/bifromq/blob/main/bifromq-plugin/bifromq-plugin-auth-provider/src/main/proto/mqtt_actions.proto",children:"MQTTAction"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-protobuf",children:"message PubAction {\n  string topic = 1;\n  commontype.QoS qos = 2;\n  bool isRetained = 3;\n  commontype.UserProperties userProps = 4;\n}\n\nmessage SubAction {\n  string topicFilter = 1;\n  commontype.QoS qos = 2;\n  commontype.UserProperties userProps = 5;\n}\n\nmessage UnsubAction {\n  string topicFilter = 1;\n  commontype.UserProperties userProps = 2;\n}\n\nmessage MQTTAction {\n  oneof Type{\n    PubAction pub = 1;\n    SubAction sub = 2;\n    UnsubAction unsub = 3;\n  }\n}\n"})}),"\n",(0,r.jsx)(n.h4,{id:"checkresult",children:(0,r.jsx)(n.a,{href:"https://github.com/bifromqio/bifromq/blob/main/bifromq-plugin/bifromq-plugin-auth-provider/src/main/proto/mqtt_actions.proto",children:"CheckResult"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-protobuf",children:"message Granted{\n  commontype.UserProperties userProps = 1; // user properties return back via mqtt5 pubAck/pubRel\n}\n\nmessage Denied{\n  optional string reason = 1;\n  commontype.UserProperties userProps = 2; // user properties return back via mqtt5 pubAck/pubRel or disconnect in case QoS0\n}\n\nmessage Error{\n  optional string reason = 1;\n  commontype.UserProperties userProps = 2; // user properties return back via mqtt5 pubAck/pubRel or disconnect in case QoS0\n}\n\nmessage CheckResult {\n  oneof Type{\n    Granted granted = 1;\n    Denied denied = 2;\n    Error error = 3;\n  }\n}\n"})}),"\n",(0,r.jsx)(n.h2,{id:"metrics",children:"Metrics"}),"\n",(0,r.jsx)(n.p,{children:"Because the two methods of the AuthProvider Plugin are frequently called during connection authentication and the process of handling message publication and subscription forwarding, BifroMQ records and outputs the following metrics to help\nplugin implementers observe the performance indicators of the plugin interface methods:"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Metric Name"}),(0,r.jsx)(n.th,{children:"Meter Type"}),(0,r.jsxs)(n.th,{children:["Tag(",(0,r.jsx)(n.code,{children:"method"}),")"]}),(0,r.jsx)(n.th,{children:"Description"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"call.exec.timer"})}),(0,r.jsx)(n.td,{children:"TIMER"}),(0,r.jsx)(n.td,{children:"AuthProvider/auth"}),(0,r.jsxs)(n.td,{children:["Latency for ",(0,r.jsx)(n.code,{children:"auth"})," call"]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"call.exec.fail.count"})}),(0,r.jsx)(n.td,{children:"COUNTER"}),(0,r.jsx)(n.td,{children:"AuthProvider/auth"}),(0,r.jsxs)(n.td,{children:["Fail counter for ",(0,r.jsx)(n.code,{children:"auth"})," call"]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"call.exec.timer"})}),(0,r.jsx)(n.td,{children:"TIMER"}),(0,r.jsx)(n.td,{children:"AuthProvider/extAuth"}),(0,r.jsxs)(n.td,{children:["Latency for ",(0,r.jsx)(n.code,{children:"extendedAuth"})," call"]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"call.exec.fail.count"})}),(0,r.jsx)(n.td,{children:"COUNTER"}),(0,r.jsx)(n.td,{children:"AuthProvider/extAuth"}),(0,r.jsxs)(n.td,{children:["Fail counter for ",(0,r.jsx)(n.code,{children:"extendedAuth"})," call"]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"call.exec.timer"})}),(0,r.jsx)(n.td,{children:"TIMER"}),(0,r.jsx)(n.td,{children:"AuthProvider/check"}),(0,r.jsxs)(n.td,{children:["Latency for ",(0,r.jsx)(n.code,{children:"checkPermission"})," call"]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"call.exec.fail.count"})}),(0,r.jsx)(n.td,{children:"COUNTER"}),(0,r.jsx)(n.td,{children:"AuthProvider/check"}),(0,r.jsxs)(n.td,{children:["Fail counter for ",(0,r.jsx)(n.code,{children:"checkPermission"})," call"]})]})]})]}),"\n",(0,r.jsx)(n.h2,{id:"devonly-mode",children:"DevOnly Mode"}),"\n",(0,r.jsxs)(n.p,{children:["By default, when no AuthPlugin type is specified, BifroMQ loads the ",(0,r.jsx)(n.a,{href:"https://github.com/bifromqio/bifromq/blob/main/bifromq-server/src/main/java/com/baidu/bifromq/server/service/authprovider/DevOnlyAuthProvider.java",children:"DevOnlyAuthProvider"}),",\nbypassing client authentication and permission checks. This mode is strictly for development and testing purposes due to its lack of security."]}),"\n",(0,r.jsx)(n.h2,{id:"implementation-example",children:"Implementation Example"}),"\n",(0,r.jsxs)(n.p,{children:["BifroMQ includes a demonstration implementation of a WebHook-based AuthProvider that can be enabled by specifying ",(0,r.jsx)(n.code,{children:"authProviderFQN"})," as ",(0,r.jsx)(n.code,{children:"com.baidu.demo.plugin.DemoAuthProvider"})," in\nthe ",(0,r.jsx)(n.a,{href:"/docs/3.2.x/admin_guide/configuration/config_file_manual",children:"configuration file"}),". The example implementation uses the JVM startup parameter (",(0,r.jsx)(n.code,{children:"-Dplugin.authprovider.url"}),") to specify a webhook callback URL."]}),"\n",(0,r.jsxs)(n.p,{children:["When BifroMQ triggers the auth method, the plugin initializes an HTTP POST request. Within this request, we transform the protobuf message ",(0,r.jsx)(n.code,{children:"MQTT3AuthData"})," into JSON format to serve as its body. The content of the response body is then interpreted and converted into the appropriate ",(0,r.jsx)(n.code,{children:"MQTT3AuthResult"})," value type."]}),"\n",(0,r.jsxs)(n.p,{children:["Below is a simple Node implementation of a WebhookServer for testing the example plugin, with webhook URLs: ",(0,r.jsx)(n.code,{children:"http://<ADDR>:<PORT>/auth"}),", ",(0,r.jsx)(n.code,{children:"http://<ADDR>:<PORT>/check"})," and ",(0,r.jsx)(n.code,{children:"http://<ADDR>:<PORT>/register"})," for authentication, checking pub/sub permission and registering users' information,\nrespectively."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:"const http = require('http');\nconst url = require('url'); \n\nconst authMap = {};\nconst server = http.createServer((req, res) => {\n  const parsedUrl = url.parse(req.url, true);\n  const pathname = parsedUrl.pathname;\n\n  res.setHeader('Content-Type', 'text/plain');\n\n  if (pathname === '/auth') {\n    let body = '';\n    req.on('data', (chunk) => {\n      body += chunk.toString();\n    });\n\n    req.on('end', () => {\n      let data = {}\n      try {\n        data = JSON.parse(body);\n      } catch (error) {\n        res.writeHead(400, { 'Content-Type': 'text/plain' });\n        res.end('Invalid JSON');\n      }\n      if (data.username && data.password) {\n        const user = authMap[data.username];\n        if (user && user.password === data.password) {\n          res.writeHead(200, { 'Content-Type': 'application/json' });\n          res.end(JSON.stringify({ \"ok\": { \"tenantId\": user.tenantId, \"userId\": data.username} }));\n        } else {\n          res.writeHead(403, { 'Content-Type': 'application/json' });\n          res.end(JSON.stringify({ \"reject\": \"NotAuthorized\" }));\n        }\n      } else {\n        res.writeHead(400, { 'Content-Type': 'text/plain' });\n        res.end('Missing username or password');\n      }\n    });\n  } else if (pathname === '/check') {\n    if (!req.method === 'POST') {\n      res.writeHead(404);\n    }\n    const tenantId = req.headers['tenant_id'];\n    const userId = req.headers['user_id'];\n    if (tenantId && userId) {\n      res.writeHead(200, { 'Content-Type': 'text/plain' });\n      if (userId in authMap) {\n        res.end(\"true\");\n      } else {\n        res.end(\"false\");\n      }\n    } else {\n      res.writeHead(400, { 'Content-Type': 'text/plain' });\n      res.end(\"Missing user_id or tenant_id\");\n    }\n  } else if (pathname === '/register') {\n    const tenantId = req.headers['tenant_id'];\n    const userId = req.headers['user_id'];\n    const password = req.headers['password'];\n\n    if (tenantId && userId && password) {\n      if (!authMap[userId]) {\n        authMap[userId] = {\n          password: btoa(password),\n          tenantId: tenantId\n        };\n        res.writeHead(200, { 'Content-Type': 'text/plain' });\n        res.end(\"User registered successfully\");\n      } else {\n        res.writeHead(400, { 'Content-Type': 'application/json' });\n        res.end(\"User already exists\");\n      }\n    } else {\n      res.writeHead(400, { 'Content-Type': 'text/plain' });\n      res.end(\"Missing user_id, password or tenant_id\");\n    }\n  } else {\n    res.writeHead(404);\n    res.end('Not Found');\n  }\n});\n\nconst args = process.argv.slice(2);\nconst hostname = args[0] || 'localhost';\nconst port = args[1] || 3000;\n\nserver.listen(port, hostname, () => {\n  console.log(`Server listening on port ${server.address().port}`);\n});\n\n"})}),"\n",(0,r.jsx)(n.p,{children:"In this example, we simply convert the registered password to Base64 format for storage. Please choose a more secure and reliable method for handling it in actual usage."})]})}function h(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(l,{...e})}):l(e)}},53546:(e,n,t)=>{t.d(n,{R:()=>o,x:()=>a});var i=t(59729);const r={},s=i.createContext(r);function o(e){const n=i.useContext(s);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),i.createElement(s.Provider,{value:n},e.children)}}}]);